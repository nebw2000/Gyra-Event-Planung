<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neues Event</title>
<style>
    body { font-family: Arial; margin:0; background:#f4f6f8; display:flex; justify-content:center; align-items:flex-start; padding-top:20px; }
    .container { background:white; padding:30px; border-radius:8px; width:100%; max-width:600px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    h2 { margin-top:0; color:#0f5f57; }
    label { display:block; font-weight:bold; margin:10px 0 4px; }
    input, select { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; }
    input[type="checkbox"] { width:auto; }
    button { width:100%; padding:10px; margin-top:15px; border:none; border-radius:6px; background:#0f5f57; color:white; cursor:pointer; }
    #toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
</style>
</head>
<body>

<div class="container">
    <div id="toast"></div>
    <h2>Neues Event</h2>
    
    <label for="name">Name</label>
    <input id="name" type="text" required>

    <label for="leader">Leiter</label>
    <input id="leader" type="text" required>

    <label for="type">Typ</label>
    <select id="type">
        <option>Probe</option>
        <option>Konzert</option>
        <option>Theater</option>
        <option>Konferenz</option>
        <option>Präsentation</option>
        <option>Rede</option>
        <option>Andere</option>
    </select>

    <label for="location">Ort</label>
    <select id="location">
        <option>Atrium</option>
        <option>Forum</option>
    </select>

    <label for="mic">Mikros</label>
    <select id="mic">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>Mehr</option>
    </select>

    <label for="vocals">Gesangs-Mikros</label>
    <select id="vocals">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>Mehr</option>
    </select>

    <label><input type="checkbox" id="podium"> Rednerpult benötigt</label>

    <label for="beamer">Beamer</label>
    <select id="beamer">
        <option>Nein</option>
        <option>Ja Bühne</option>
        <option>Ja Wand</option>
        <option>Ja beide</option>
    </select>

    <label for="keyboard">Keyboards</label>
    <select id="keyboard">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
    </select>

    <label for="guitar">Gitarren</label>
    <select id="guitar">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
    </select>

    <label for="date">Datum</label>
    <input id="date" type="date" required>

    <label for="time">Uhrzeit</label>
    <input id="time" type="time" required>

    <label for="script">Skript (optional)</label>
    <input id="script" type="file">

    <label for="comments">Kommentar (optional)</label>
    <input id="comments" type="text">

    <button id="saveBtn">Speichern</button>
</div>

<script type="module">
import { auth, db } from "./firebase-config.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";
import { ref, push } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

// LOGIN SCHUTZ
onAuthStateChanged(auth, user => { if(!user) window.location.href="login.html"; });

const fields = {
    name: document.getElementById("name"),
    leader: document.getElementById("leader"),
    type: document.getElementById("type"),
    location: document.getElementById("location"),
    mic: document.getElementById("mic"),
    vocals: document.getElementById("vocals"),
    podium: document.getElementById("podium"),
    beamer: document.getElementById("beamer"),
    keyboard: document.getElementById("keyboard"),
    guitar: document.getElementById("guitar"),
    date: document.getElementById("date"),
    time: document.getElementById("time"),
    script: document.getElementById("script"),
    comments: document.getElementById("comments")
};

const saveBtn = document.getElementById("saveBtn");
const toast = document.getElementById("toast");

function showToast(msg){
    toast.textContent = msg;
    toast.style.display="block";
    setTimeout(()=>{toast.style.display="none";},3000);
}

saveBtn.addEventListener("click", async ()=>{
    if(!fields.name.value || !fields.leader.value || !fields.date.value || !fields.time.value){
        showToast("Bitte alle Pflichtfelder ausfüllen");
        return;
    }

    const updated = {
        name: fields.name.value,
        leader: fields.leader.value,
        type: fields.type.value,
        location: fields.location.value,
        mic: fields.mic.value,
        vocals: fields.vocals.value,
        podium: fields.podium.checked ? "X" : "",
        beamer: fields.beamer.value,
        keyboard: fields.keyboard.value,
        guitar: fields.guitar.value,
        date: fields.date.value,
        time: fields.time.value,
        script: fields.script.files[0]?fields.script.files[0].name:null,
        comments: fields.comments.value || ""
    };

    try{
        await push(ref(db,"events"), updated);
        showToast("Event erfolgreich gespeichert!");
        setTimeout(()=>{ window.location.href="index.html"; },1000);
    }catch(e){
        showToast("Fehler: "+e.message);
    }
});
</script>

</body>
</html>
