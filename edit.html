<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event bearbeiten</title>
<style>
body { font-family: Arial; margin:0; background:#f4f6f8; }
.container { max-width:500px; margin:20px auto; background:white; padding:20px; border-radius:8px; }
label { display:block; margin-top:10px; font-weight:bold; }
input, select, textarea { width:100%; padding:6px; margin-top:4px; border-radius:6px; border:1px solid #ccc; }
button { margin-top:15px; padding:10px; width:100%; border:none; border-radius:6px; background:#0f5f57; color:white; cursor:pointer; }
#toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
</style>
</head>
<body>
<div class="container">
<div id="toast"></div>
<h2>Event bearbeiten</h2>
<label>Name</label><input id="name">
<label>Leiter</label><input id="leader">
<label>Typ</label>
<select id="type">
    <option>Probe</option>
    <option>Konzert</option>
    <option>Theater</option>
    <option>Konferenz</option>
    <option>Präsentation</option>
    <option>Rede</option>
    <option>Andere</option>
</select>
<label>Ort</label>
<select id="location">
    <option>Atrium</option>
    <option>Forum</option>
</select>
<label>Micro Anzahl</label>
<select id="mic"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>mehr</option></select>
<label>Gesangs-Mic</label>
<select id="vocMic"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>mehr</option></select>
<label>Rednerpult</label><input type="checkbox" id="podium">
<label>Beamer</label>
<select id="beamer">
    <option>Nein</option>
    <option>Ja Bühne</option>
    <option>Ja Wand</option>
    <option>Ja beide</option>
</select>
<label>Keyboards</label>
<select id="keyboard"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
<label>Gitarren</label>
<select id="guitar"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option></select>
<label>Datum</label><input type="date" id="date">
<label>Uhrzeit</label><input type="time" id="time">
<label>Skript (optional)</label><input type="file" id="script">
<label>Kommentar (optional)</label><textarea id="comments"></textarea>
<button id="saveBtn">Speichern</button>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { ref, get, set } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

const toast = document.getElementById("toast");
function showToast(msg){ toast.textContent=msg; toast.style.display="block"; setTimeout(()=>{toast.style.display="none";},3000); }

const urlParams = new URLSearchParams(window.location.search);
const eventId = urlParams.get("id");
const saveBtn = document.getElementById("saveBtn");

if(!eventId) {
    showToast("Keine Event-ID gefunden");
    setTimeout(()=>window.location.href="index.html",2000);
}

async function loadEvent(){
    const snapshot = await get(ref(db,"events/"+eventId));
    if(snapshot.exists()){
        const e = snapshot.val();
        document.getElementById("name").value = e.name;
        document.getElementById("leader").value = e.leader;
        document.getElementById("type").value = e.type;
        document.getElementById("location").value = e.location;
        document.getElementById("mic").value = e.mic;
        document.getElementById("vocMic").value = e.vocMic;
        document.getElementById("podium").checked = e.podium === "x";
        document.getElementById("beamer").value = e.beamer;
        document.getElementById("keyboard").value = e.keyboard;
        document.getElementById("guitar").value = e.guitar;
        document.getElementById("date").value = e.date;
        document.getElementById("time").value = e.time;
        document.getElementById("comments").value = e.comments || "";
    } else {
        showToast("Event nicht gefunden");
    }
}

saveBtn.addEventListener("click", async ()=>{
    const data = {
        name: document.getElementById("name").value,
        leader: document.getElementById("leader").value,
        type: document.getElementById("type").value,
        location: document.getElementById("location").value,
        mic: document.getElementById("mic").value,
        vocMic: document.getElementById("vocMic").value,
        podium: document.getElementById("podium").checked ? "x" : "",
        beamer: document.getElementById("beamer").value,
        keyboard: document.getElementById("keyboard").value,
        guitar: document.getElementById("guitar").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        comments: document.getElementById("comments").value || "",
        script: document.getElementById("script").files[0]?.name || ""
    };
    await set(ref(db,"events/"+eventId), data);
    showToast("Event gespeichert!");
    setTimeout(()=>window.location.href="index.html",1000);
});

loadEvent();
</script>
</body>
</html>
