<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Plan</title>
<style>
body { font-family: Arial; margin:0; background:#f4f6f8; display:flex; justify-content:center; align-items:center; min-height:100vh; }
.container { background:white; padding:30px; border-radius:12px; width:100%; max-width:500px; box-shadow:0 0 15px rgba(0,0,0,0.2); }
h2 { margin-top:0; color:#0f5f57; text-align:center; }
label { display:block; font-weight:bold; margin:10px 0 4px; }
input, select { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px; }
button { width:100%; padding:10px; border:none; border-radius:8px; background:#0f5f57; color:white; cursor:pointer; margin-top:5px; }
#toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
.event-item { background:#e0f0f0; padding:10px; border-radius:6px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center; }
.event-item span { flex:1; }
.event-item button { margin-left:5px; }
</style>
</head>
<body>

<div class="container" id="login-container">
    <h2>Login</h2>
    <label for="role">Rolle</label>
    <select id="role">
        <option value="admin">Admin</option>
        <option value="teacher">Lehrer</option>
    </select>
    <label for="password">Passwort</label>
    <input id="password" type="password">
    <button id="loginBtn">Login</button>
</div>

<div class="container" id="main-container" style="display:none;">
    <h2>Event Übersicht</h2>
    <div style="text-align:center; margin-bottom:10px;">
        <button id="newEventBtn">Neues Event hinzufügen</button>
    </div>
    <div id="eventList"></div>
    
    <div id="newEventForm" style="display:none;">
        <h2>Neues Event</h2>
        <label>Name</label><input id="evName">
        <label>Leiter</label><input id="evLeader">
        <label>Typ</label>
        <select id="evType">
            <option>Probe</option><option>Konzert</option><option>Theater</option>
            <option>Konferenz</option><option>Präsentation</option><option>Rede</option><option>Andere</option>
        </select>
        <label>Ort</label>
        <select id="evLocation">
            <option>Atrium</option><option>Forum</option>
        </select>
        <label>Datum</label><input id="evDate" type="date">
        <label>Uhrzeit</label><input id="evTime" type="time">
        <label>Microfone (Gesamt)</label>
        <select id="evMic"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select>
        <label>Gesangs-Microfone</label>
        <select id="evVocals"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select>
        <label>Rednerpult</label>
        <select id="evPodium"><option>Ja</option><option>Nein</option></select>
        <label>Beamer</label>
        <select id="evBeamer"><option>Nein</option><option>Ja Bühne</option><option>Ja Wand</option><option>Ja beide</option></select>
        <label>Keyboard</label><select id="evKeyboard"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select>
        <label>Gitarren</label><select id="evGuitar"><option>0</option><option>1</option><option>2</option><option>3</option><option>4</option><option>5+</option></select>
        <label>Kommentar (optional)</label><input id="evComments">
        <button id="saveEventBtn">Speichern</button>
    </div>
</div>

<div id="toast"></div>

<script type="module">
import { auth, db } from "./firebase-config.js";
import { ref, set, get, remove, onValue } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

const loginContainer = document.getElementById("login-container");
const mainContainer = document.getElementById("main-container");
const toast = document.getElementById("toast");
const roleField = document.getElementById("role");
const passwordField = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const newEventBtn = document.getElementById("newEventBtn");
const newEventForm = document.getElementById("newEventForm");
const saveEventBtn = document.getElementById("saveEventBtn");
const eventList = document.getElementById("eventList");

let currentRole = null;
let editingId = null;

function showToast(msg){
    toast.textContent = msg;
    toast.style.display="block";
    setTimeout(()=>{toast.style.display="none";},3000);
}

loginBtn.addEventListener("click", ()=>{
    const role = roleField.value;
    const pass = passwordField.value.trim();
    if((role==="admin" && pass==="2309") || (role==="teacher" && pass==="event")){
        currentRole = role;
        loginContainer.style.display="none";
        mainContainer.style.display="block";
        loadEvents();
    } else showToast("Falsches Passwort");
});

newEventBtn.addEventListener("click", ()=>{ newEventForm.style.display="block"; });

function loadEvents(){
    eventList.innerHTML="";
    const eventsRef = ref(db,"events");
    onValue(eventsRef, snapshot=>{
        eventList.innerHTML="";
        const data = snapshot.val();
        if(data){
            Object.keys(data).forEach(id=>{
                const e = data[id];
                const div = document.createElement("div");
                div.className="event-item";
                div.innerHTML = `
                    <span>${e.name} (${e.date} ${e.time})</span>
                    <button class="viewBtn">Ansehen</button>
                    <button class="editBtn">Bearbeiten</button>
                    <button class="delBtn">Löschen</button>
                `;
                div.querySelector(".delBtn").onclick = ()=>{
                    remove(ref(db,"events/"+id));
                    showToast("Event gelöscht");
                };
                div.querySelector(".editBtn").onclick = ()=>{
                    editingId = id;
                    document.getElementById("evName").value=e.name;
                    document.getElementById("evLeader").value=e.leader;
                    document.getElementById("evType").value=e.type;
                    document.getElementById("evLocation").value=e.location;
                    document.getElementById("evDate").value=e.date;
                    document.getElementById("evTime").value=e.time;
                    document.getElementById("evMic").value=e.mic;
                    document.getElementById("evVocals").value=e.vocals;
                    document.getElementById("evPodium").value=e.podium;
                    document.getElementById("evBeamer").value=e.beamer;
                    document.getElementById("evKeyboard").value=e.keyboard;
                    document.getElementById("evGuitar").value=e.guitar;
                    document.getElementById("evComments").value=e.comments||"";
                    newEventForm.style.display="block";
                };
                div.querySelector(".viewBtn").onclick = ()=>{
                    const info = `
Name: ${e.name}
Leiter: ${e.leader}
Typ: ${e.type}
Ort: ${e.location}
Datum: ${e.date} ${e.time}
Microfone: ${e.mic}
Gesangs-Microfone: ${e.vocals}
Rednerpult: ${e.podium}
Beamer: ${e.beamer}
Keyboard: ${e.keyboard}
Gitarren: ${e.guitar}
Kommentar: ${e.comments||"-"}
                    `;
                    alert(info);
                };
                eventList.appendChild(div);
            });
        }
    });
}

saveEventBtn.addEventListener("click", ()=>{
    const ev = {
        name: document.getElementById("evName").value,
        leader: document.getElementById("evLeader").value,
        type: document.getElementById("evType").value,
        location: document.getElementById("evLocation").value,
        date: document.getElementById("evDate").value,
        time: document.getElementById("evTime").value,
        mic: document.getElementById("evMic").value,
        vocals: document.getElementById("evVocals").value,
        podium: document.getElementById("evPodium").value,
        beamer: document.getElementById("evBeamer").value,
        keyboard: document.getElementById("evKeyboard").value,
        guitar: document.getElementById("evGuitar").value,
        comments: document.getElementById("evComments").value
    };
    const key = editingId || Date.now();
    set(ref(db,"events/"+key), ev).then(()=>{
        showToast("Event gespeichert");
        newEventForm.style.display="none";
        editingId = null;
    });
});
</script>
</body>
</html>
