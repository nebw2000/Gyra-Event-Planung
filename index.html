<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Manager</title>
<style>
body { font-family: Arial; margin:0; background:#f4f6f8; }
header { background:#0f5f57; color:white; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; }
header h2 { margin:0; }
header button { background:white; color:#0f5f57; border:none; padding:8px 14px; border-radius:6px; cursor:pointer; }
.container { max-width:900px; margin:auto; padding:20px; }
#toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
.event-card { background:white; border-radius:8px; padding:10px 15px; margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
.event-card div { display:flex; flex-direction:column; }
.event-card button { margin-left:5px; padding:4px 8px; border:none; border-radius:5px; cursor:pointer; }
#addEventForm { background:white; padding:20px; border-radius:8px; margin-bottom:20px; display:none; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
input, select { width:100%; padding:6px 8px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc; }
button.save { background:#0f5f57; color:white; width:100%; padding:10px; border:none; border-radius:6px; cursor:pointer; }
#search { width:100%; padding:6px 8px; margin-bottom:20px; border-radius:6px; border:1px solid #ccc; }
</style>
</head>
<body>

<header>
    <h2>Event Manager</h2>
    <button id="showAddEvent">Neues Event hinzufügen</button>
</header>

<div class="container">
    <div id="toast"></div>

    <input type="text" id="search" placeholder="Suche nach Name oder Leiter">

    <div id="addEventForm">
        <h3>Neues Event</h3>
        <label>Name</label>
        <input id="name" type="text">
        <label>Leiter</label>
        <input id="leader" type="text">
        <label>Typ</label>
        <select id="type">
            <option>Probe</option>
            <option>Konzert</option>
            <option>Theater</option>
            <option>Konferenz</option>
            <option>Präsentation</option>
            <option>Rede</option>
            <option>Andere</option>
        </select>
        <label>Ort</label>
        <select id="location">
            <option>Atrium</option>
            <option>Forum</option>
        </select>
        <label>Datum & Uhrzeit</label>
        <input id="datetime" type="datetime-local">
        <label>Microfone</label>
        <select id="mic">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 oder mehr</option>
        </select>
        <label>Gesangs-Mic</label>
        <select id="vocals">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 oder mehr</option>
        </select>
        <label>Rednerpult</label>
        <select id="podium">
            <option>Ja</option>
            <option>Nein</option>
        </select>
        <label>Beamer</label>
        <select id="beamer">
            <option>Ja Bühne</option>
            <option>Ja Wand</option>
            <option>Ja beide</option>
            <option>Nein</option>
        </select>
        <label>Keyboards</label>
        <select id="keyboard">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 oder mehr</option>
        </select>
        <label>Gitarren</label>
        <select id="guitar">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5 oder mehr</option>
        </select>
        <label>Kommentar (optional)</label>
        <input id="comments" type="text">
        <button class="save" id="saveBtn">Speichern</button>
    </div>

    <div id="eventList"></div>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { ref, set, get, remove } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

// Toast Funktion
function showToast(msg){
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.style.display="block";
    setTimeout(()=>{toast.style.display="none";},3000);
}

const addEventForm = document.getElementById("addEventForm");
document.getElementById("showAddEvent").onclick = ()=>{ addEventForm.style.display="block"; };

// Event speichern
document.getElementById("saveBtn").onclick = async ()=>{
    const id = Date.now().toString();
    const eventData = {
        name: document.getElementById("name").value,
        leader: document.getElementById("leader").value,
        type: document.getElementById("type").value,
        location: document.getElementById("location").value,
        datetime: document.getElementById("datetime").value,
        mic: document.getElementById("mic").value,
        vocals: document.getElementById("vocals").value,
        podium: document.getElementById("podium").value,
        beamer: document.getElementById("beamer").value,
        keyboard: document.getElementById("keyboard").value,
        guitar: document.getElementById("guitar").value,
        comments: document.getElementById("comments").value || ""
    };

    await set(ref(db,"events/"+id), eventData);
    showToast("Event erfolgreich gespeichert!");
    addEventForm.style.display="none";
    loadEvents();
};

// Events laden
async function loadEvents(){
    const listEl = document.getElementById("eventList");
    listEl.innerHTML="";
    const snapshot = await get(ref(db,"events"));
    if(!snapshot.exists()) return;
    const events = Object.entries(snapshot.val());
    events.sort((a,b)=> new Date(a[1].datetime) - new Date(b[1].datetime));
    
    for(const [id,e] of events){
        const card = document.createElement("div");
        card.className="event-card";
        const info = document.createElement("div");
        info.innerHTML=`<strong>${e.name}</strong><span>${e.leader} | ${e.type} | ${e.location} | ${e.datetime}</span>`;
        card.appendChild(info);

        const btns = document.createElement("div");
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent="Löschen";
        deleteBtn.onclick=async ()=>{ await remove(ref(db,"events/"+id)); showToast("Event gelöscht"); loadEvents(); };
        btns.appendChild(deleteBtn);
        card.appendChild(btns);

        listEl.appendChild(card);
    }
}

// Suche
document.getElementById("search").addEventListener("input", async (e)=>{
    const val = e.target.value.toLowerCase();
    const snapshot = await get(ref(db,"events"));
    if(!snapshot.exists()) return;
    const events = Object.entries(snapshot.val()).filter(([id,e])=>
        e.name.toLowerCase().includes(val) || e.leader.toLowerCase().includes(val)
    );
    const listEl = document.getElementById("eventList");
    listEl.innerHTML="";
    for(const [id,e] of events){
        const card = document.createElement("div");
        card.className="event-card";
        const info = document.createElement("div");
        info.innerHTML=`<strong>${e.name}</strong><span>${e.leader} | ${e.type} | ${e.location} | ${e.datetime}</span>`;
        card.appendChild(info);

        const btns = document.createElement("div");
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent="Löschen";
        deleteBtn.onclick=async ()=>{ await remove(ref(db,"events/"+id)); showToast("Event gelöscht"); loadEvents(); };
        btns.appendChild(deleteBtn);
        card.appendChild(btns);

        listEl.appendChild(card);
    }
});

loadEvents();
</script>
</body>
</html>
