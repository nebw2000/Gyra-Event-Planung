<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Planer</title>
<style>
body { font-family: Arial; margin:0; background:#f4f6f8; }
header { background:#0f5f57; color:white; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; }
header h2 { margin:0; }
header button { background:#ffffff33; border:none; padding:8px 14px; color:white; border-radius:6px; cursor:pointer; }
.container { max-width:1000px; margin:auto; padding:20px; }
.event-list { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:10px; }
.card { background:white; padding:15px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1); position:relative; }
.card h3 { margin:0 0 10px 0; color:#0f5f57; }
.card button { margin-right:5px; padding:5px 8px; border:none; border-radius:6px; cursor:pointer; }
#addEventForm { display:none; background:white; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.2); margin-bottom:20px; }
label { display:block; margin-top:10px; font-weight:bold; }
input, select, textarea { width:100%; padding:6px; border-radius:6px; border:1px solid #ccc; margin-top:3px; }
button.saveBtn { background:#0f5f57; color:white; margin-top:10px; width:100%; }
#toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
</style>
</head>
<body>

<header>
    <h2>Event Übersicht</h2>
    <button id="addEventBtn">Event hinzufügen</button>
</header>

<div class="container">
    <div id="toast"></div>

    <div id="addEventForm">
        <h3>Neues Event</h3>
        <label>Name</label>
        <input id="name" type="text">
        <label>Leiter</label>
        <input id="leader" type="text">
        <label>Typ</label>
        <select id="type">
            <option>Probe</option>
            <option>Konzert</option>
            <option>Theater</option>
            <option>Konferenz</option>
            <option>Präsentation</option>
            <option>Rede</option>
            <option>Andere</option>
        </select>
        <label>Ort</label>
        <select id="location">
            <option>Atrium</option>
            <option>Forum</option>
        </select>
        <label>Mikros</label>
        <select id="mic">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>mehr</option>
        </select>
        <label>Gesangsmikros</label>
        <select id="vocals">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>mehr</option>
        </select>
        <label>Rednerpult</label>
        <select id="podium">
            <option>Ja</option>
            <option>Nein</option>
        </select>
        <label>Beamer</label>
        <select id="beamer">
            <option>Ja Bühne</option>
            <option>Ja Wand</option>
            <option>Ja beide</option>
            <option>Nein</option>
        </select>
        <label>Keyboards</label>
        <select id="keyboard">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
        <label>Gitarren</label>
        <select id="guitar">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
        <label>Kommentar (optional)</label>
        <textarea id="comments"></textarea>
        <label>Datum & Uhrzeit</label>
        <input type="datetime-local" id="eventDate">

        <button class="saveBtn" id="saveEvent">Speichern</button>
    </div>

    <div class="event-list" id="eventsContainer"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
import { getDatabase, ref, set, get, remove, onValue } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

// Firebase-Konfiguration
const firebaseConfig = {
  apiKey: "AIzaSyCXX4CwnX_eRiKBURJeORfGoYI0k0hdHkA",
  authDomain: "event-plan-c4b36.firebaseapp.com",
  databaseURL: "https://event-plan-c4b36-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "event-plan-c4b36",
  storageBucket: "event-plan-c4b36.firebasestorage.app",
  messagingSenderId: "489710650124",
  appId: "1:489710650124:web:6a515ffd6ec3d9983aff29",
  measurementId: "G-CPW8C0JVZX"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const toast = document.getElementById("toast");
function showToast(msg){
    toast.textContent = msg;
    toast.style.display="block";
    setTimeout(()=>{ toast.style.display="none"; },3000);
}

const addEventBtn = document.getElementById("addEventBtn");
const addEventForm = document.getElementById("addEventForm");
addEventBtn.addEventListener("click", ()=>{ addEventForm.style.display="block"; });

const saveBtn = document.getElementById("saveEvent");
saveBtn.addEventListener("click", async ()=>{
    const eventId = Date.now();
    const updated = {
        name: document.getElementById("name").value,
        leader: document.getElementById("leader").value,
        type: document.getElementById("type").value,
        location: document.getElementById("location").value,
        mic: document.getElementById("mic").value,
        vocals: document.getElementById("vocals").value,
        podium: document.getElementById("podium").value,
        beamer: document.getElementById("beamer").value,
        keyboard: document.getElementById("keyboard").value,
        guitar: document.getElementById("guitar").value,
        comments: document.getElementById("comments").value || "",
        date: document.getElementById("eventDate").value
    };
    await set(ref(db,"events/"+eventId), updated);
    showToast("Event erfolgreich gespeichert!");
    addEventForm.reset();
    addEventForm.style.display="none";
});

// Events live laden
const eventsContainer = document.getElementById("eventsContainer");
const eventsRef = ref(db,"events");
onValue(eventsRef, snapshot=>{
    eventsContainer.innerHTML="";
    snapshot.forEach(child=>{
        const e = child.val();
        const id = child.key;
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML = `
            <h3>${e.name}</h3>
            <p><b>Leiter:</b> ${e.leader}</p>
            <p><b>Typ:</b> ${e.type}</p>
            <p><b>Ort:</b> ${e.location}</p>
            <p><b>Mikros:</b> ${e.mic}, Gesang: ${e.vocals}</p>
            <p><b>Rednerpult:</b> ${e.podium}</p>
            <p><b>Beamer:</b> ${e.beamer}</p>
            <p><b>Keyboards:</b> ${e.keyboard}, Gitarren: ${e.guitar}</p>
            <p><b>Datum:</b> ${e.date}</p>
            <p><b>Kommentar:</b> ${e.comments}</p>
            <button class="editBtn">Bearbeiten</button>
            <button class="deleteBtn">Löschen</button>
        `;
        const editBtn = card.querySelector(".editBtn");
        editBtn.addEventListener("click", ()=>{
            addEventForm.style.display="block";
            document.getElementById("name").value=e.name;
            document.getElementById("leader").value=e.leader;
            document.getElementById("type").value=e.type;
            document.getElementById("location").value=e.location;
            document.getElementById("mic").value=e.mic;
            document.getElementById("vocals").value=e.vocals;
            document.getElementById("podium").value=e.podium;
            document.getElementById("beamer").value=e.beamer;
            document.getElementById("keyboard").value=e.keyboard;
            document.getElementById("guitar").value=e.guitar;
            document.getElementById("comments").value=e.comments;
            document.getElementById("eventDate").value=e.date;
            saveBtn.onclick = async ()=>{
                await set(ref(db,"events/"+id), {
                    name: document.getElementById("name").value,
                    leader: document.getElementById("leader").value,
                    type: document.getElementById("type").value,
                    location: document.getElementById("location").value,
                    mic: document.getElementById("mic").value,
                    vocals: document.getElementById("vocals").value,
                    podium: document.getElementById("podium").value,
                    beamer: document.getElementById("beamer").value,
                    keyboard: document.getElementById("keyboard").value,
                    guitar: document.getElementById("guitar").value,
                    comments: document.getElementById("comments").value || "",
                    date: document.getElementById("eventDate").value
                });
                showToast("Event erfolgreich bearbeitet!");
                addEventForm.reset();
                addEventForm.style.display="none";
            }
        });

        const deleteBtn = card.querySelector(".deleteBtn");
        deleteBtn.addEventListener("click", ()=>{ remove(ref(db,"events/"+id)); });

        eventsContainer.appendChild(card);
    });
});
</script>
</body>
</html>
