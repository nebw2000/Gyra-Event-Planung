<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Event Planung</title>
    <style>
        body { font-family: Arial; margin: 0; padding: 0; }
        .hidden { display: none; }
        header { padding: 15px; background: #222; color: #fff; }
        button { padding: 8px 12px; margin: 5px; cursor: pointer; }
        .container { padding: 20px; }
        .event-box { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        input, select, textarea { width: 100%; padding: 8px; margin-top: 5px; }
        .btn-red { background: #d33; color: white; }
        .btn-green { background: #4caf50; color: white; }
    </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="container">
    <h2>Login</h2>
    <input id="username" placeholder="Benutzer">
    <input id="password" type="password" placeholder="Passwort">
    <button id="loginBtn">Login</button>
    <p id="loginError" style="color:red;"></p>
</div>

<!-- HAUPTSEITE -->
<div id="mainPage" class="hidden">
    <header>
        <h2>Event Übersicht</h2>
        <button onclick="showCreateForm()">Neues Event</button>
    </header>

    <div class="container">
        <div id="eventList"></div>
    </div>
</div>

<!-- EVENT ERSTELLEN -->
<div id="createPage" class="hidden container">
    <h2>Event erstellen</h2>

    <input id="evName" placeholder="Name">
    <input id="evLeiter" placeholder="Leitung">

    <label>Typ</label>
    <select id="evTyp">
        <option>Probe</option>
        <option>Konzert</option>
        <option>Theater</option>
        <option>Konferenz</option>
        <option>Präsentation</option>
        <option>Rede</option>
        <option>Andere</option>
    </select>

    <label>Ort</label>
    <select id="evOrt">
        <option>Atrium</option>
        <option>Forum</option>
    </select>

    <label>Mikros</label>
    <select id="evMic">
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>Mehr</option>
    </select>

    <label>Gesangs Mikros</label>
    <select id="evGesang">
        <option>0</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>Mehr</option>
    </select>

    <label>Rednerpult</label>
    <input type="checkbox" id="evPult">

    <label>Beamer</label>
    <select id="evBeamer">
        <option>Nein</option>
        <option>Ja Bühne</option>
        <option>Ja Wand</option>
        <option>Ja beide</option>
    </select>

    <label>Keyboards</label>
    <select id="evKeys">
        <option>0</option><option>1</option><option>2</option>
        <option>3</option><option>4</option><option>5</option>
    </select>

    <label>Gitarren</label>
    <select id="evGit">
        <option>0</option><option>1</option><option>2</option>
        <option>3</option><option>4</option><option>5</option>
    </select>

    <label>Skript (optional)</label>
    <input id="evSkript" placeholder="Link zum Skript">

    <label>Kommentar</label>
    <textarea id="evKommentar"></textarea>

    <label>Datum</label>
    <input id="evDatum" type="date">

    <label>Uhrzeit</label>
    <input id="evZeit" type="time">

    <button class="btn-green" onclick="saveEvent()">Speichern</button>
    <button onclick="backToMain()">Zurück</button>

    <p id="saveError" style="color:red;"></p>
</div>

<!-- EVENT DETAILS -->
<div id="detailsPage" class="hidden container">
    <h2>Event Details</h2>
    <pre id="detailsBox"></pre>
    <button onclick="backToMain()">Zurück</button>
</div>

<!-- FIREBASE -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } 
    from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCXX4CwnX_eRiKBURJeORfGoYI0k0hdHkA",
  authDomain: "event-plan-c4b36.firebaseapp.com",
  databaseURL: "https://event-plan-c4b36-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "event-plan-c4b36",
  storageBucket: "event-plan-c4b36.firebasestorage.app",
  messagingSenderId: "489710650124",
  appId: "1:489710650124:web:05423665acc223a83aff29"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const users = {
    "lehrerin": "event",
    "admin": "2309",
    "ben": "1234"
};

document.getElementById("loginBtn").onclick = () => {
    const u = username.value;
    const p = password.value;

    if (!users[u] || users[u] !== p) {
        loginError.textContent = "Falsche Daten";
        return;
    }

    loginPage.classList.add("hidden");
    mainPage.classList.remove("hidden");
    loadEvents();
};

function loadEvents() {
    const eventList = document.getElementById("eventList");
    eventList.innerHTML = "";

    const eventsRef = ref(db, "events");
    onValue(eventsRef, snapshot => {
        eventList.innerHTML = "";

        snapshot.forEach(child => {
            const id = child.key;
            const ev = child.val();

            const div = document.createElement("div");
            div.className = "event-box";
            div.innerHTML = `
                <b>${ev.name}</b><br>
                ${ev.datum} ${ev.zeit}<br>
                <button onclick="viewEvent('${id}')">Details</button>
                <button onclick="editEvent('${id}')">Bearbeiten</button>
                <button class="btn-red" onclick="deleteEvent('${id}')">Löschen</button>
            `;
            eventList.appendChild(div);
        });
    });
}

function showCreateForm() {
    mainPage.classList.add("hidden");
    createPage.classList.remove("hidden");
}

function backToMain() {
    createPage.classList.add("hidden");
    detailsPage.classList.add("hidden");
    mainPage.classList.remove("hidden");
}

window.saveEvent = () => {
    const data = {
        name: evName.value,
        leiter: evLeiter.value,
        typ: evTyp.value,
        ort: evOrt.value,
        mic: evMic.value,
        gesang: evGesang.value,
        pult: evPult.checked,
        beamer: evBeamer.value,
        keys: evKeys.value,
        git: evGit.value,
        skript: evSkript.value,
        kommentar: evKommentar.value,
        datum: evDatum.value,
        zeit: evZeit.value
    };

    push(ref(db, "events"), data)
        .then(() => {
            backToMain();
        })
        .catch(() => saveError.textContent = "Fehler beim Speichern");
};

window.deleteEvent = id => {
    remove(ref(db, "events/" + id));
};

window.viewEvent = id => {
    createPage.classList.add("hidden");
    mainPage.classList.add("hidden");
    detailsPage.classList.remove("hidden");

    onValue(ref(db, "events/" + id), snap => {
        detailsBox.textContent = JSON.stringify(snap.val(), null, 2);
    });
};

window.editEvent = id => {
    alert("Bearbeiten baue ich dir als Nächstes ein.");
};

</script>

</body>
</html>
