<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Übersicht</title>
<style>
body { font-family: Arial; margin:0; background:#f4f6f8; }
header { background:#0f5f57; color:white; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; }
header button { background:#ffffff33; border:none; padding:8px 14px; color:white; border-radius:6px; cursor:pointer; }
.container { max-width:1200px; margin:auto; padding:20px; }
#toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
.event-table { width:100%; border-collapse:collapse; }
.event-table th, .event-table td { border:1px solid #ccc; padding:8px; text-align:center; }
.event-table th { background:#0f5f57; color:white; }
button.action { padding:5px 10px; margin:2px; border:none; border-radius:4px; cursor:pointer; }
button.edit { background:#2196F3; color:white; }
button.delete { background:#f44336; color:white; }
button.details { background:#4CAF50; color:white; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:white; padding:20px; border-radius:8px; width:100%; max-width:600px; max-height:90vh; overflow-y:auto; }
.modal-content h3 { margin-top:0; color:#0f5f57; }
.modal-content label { display:block; margin:10px 0 4px; font-weight:bold; }
.modal-content input, .modal-content select, .modal-content textarea { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; }
.modal-content button { margin-top:10px; padding:10px; border:none; border-radius:6px; cursor:pointer; }
button.save { background:#0f5f57; color:white; width:48%; margin-right:4%; }
button.cancel { background:#ccc; color:black; width:48%; }
</style>
</head>
<body>

<header>
    <h2>Event Übersicht</h2>
    <button id="newEventBtn">Neues Event</button>
</header>

<div class="container">
    <div id="toast"></div>
    <table class="event-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Leiter</th>
                <th>Typ</th>
                <th>Ort</th>
                <th>Datum</th>
                <th>Uhrzeit</th>
                <th>Mikrofone</th>
                <th>Gesangs-Mics</th>
                <th>Rednerpult</th>
                <th>Beamer</th>
                <th>Keyboards</th>
                <th>Gitarren</th>
                <th>Kommentar</th>
                <th>Aktionen</th>
            </tr>
        </thead>
        <tbody id="eventList"></tbody>
    </table>
</div>

<!-- Modal für Event hinzufügen/bearbeiten -->
<div class="modal" id="eventModal">
    <div class="modal-content">
        <h3 id="modalTitle">Neues Event</h3>
        <label>Name</label>
        <input id="name" type="text" required>
        <label>Leiter</label>
        <input id="leader" type="text" required>
        <label>Typ</label>
        <select id="type">
            <option>Probe</option>
            <option>Konzert</option>
            <option>Theater</option>
            <option>Konferenz</option>
            <option>Präsentation</option>
            <option>Rede</option>
            <option>Andere</option>
        </select>
        <label>Ort</label>
        <select id="location">
            <option>Atrium</option>
            <option>Forum</option>
        </select>
        <label>Anzahl Mikrofone</label>
        <select id="mic">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>Mehr</option>
        </select>
        <label>Gesangs-Mikrofone</label>
        <select id="vocals">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
            <option>Mehr</option>
        </select>
        <label>Rednerpult</label>
        <select id="podium">
            <option>Ja</option>
            <option>Nein</option>
        </select>
        <label>Beamer</label>
        <select id="beamer">
            <option>Ja Bühne</option>
            <option>Ja Wand</option>
            <option>Ja beide</option>
            <option>Nein</option>
        </select>
        <label>Keyboards</label>
        <select id="keyboard">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
        <label>Gitarren</label>
        <select id="guitar">
            <option>0</option>
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
        </select>
        <label>Datum</label>
        <input type="date" id="date">
        <label>Uhrzeit</label>
        <input type="time" id="time">
        <label>Kommentar (optional)</label>
        <textarea id="comments" rows="3"></textarea>
        <div style="display:flex; justify-content:space-between;">
            <button class="save" id="saveEventBtn">Speichern</button>
            <button class="cancel" id="cancelBtn">Abbrechen</button>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
import { getDatabase, ref, set, get, remove } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCXX4CwnX_eRiKBURJeORfGoYI0k0hdHkA",
  authDomain: "event-plan-c4b36.firebaseapp.com",
  databaseURL: "https://event-plan-c4b36-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "event-plan-c4b36",
  storageBucket: "event-plan-c4b36.appspot.com",
  messagingSenderId: "489710650124",
  appId: "1:489710650124:web:05423665acc223a83aff29",
  measurementId: "G-KRY2MM4JEV"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
const toast = document.getElementById("toast");

function showToast(msg){
    toast.textContent = msg;
    toast.style.display="block";
    setTimeout(()=>{toast.style.display="none";},3000);
}

let editingId = null;

/* LOGIN SCHUTZ */
onAuthStateChanged(auth, user=>{
    if(!user) window.location.href="login.html";
});

/* MODAL HANDLING */
const modal = document.getElementById("eventModal");
document.getElementById("newEventBtn").addEventListener("click", ()=>{
    editingId = null;
    document.getElementById("modalTitle").textContent="Neues Event";
    modal.style.display="flex";
});
document.getElementById("cancelBtn").addEventListener("click", ()=>{
    modal.style.display="none";
});

/* SPEICHERN */
document.getElementById("saveEventBtn").addEventListener("click", async ()=>{
    const updated = {
        name: document.getElementById("name").value,
        leader: document.getElementById("leader").value,
        type: document.getElementById("type").value,
        location: document.getElementById("location").value,
        mic: document.getElementById("mic").value,
        vocals: document.getElementById("vocals").value,
        podium: document.getElementById("podium").value,
        beamer: document.getElementById("beamer").value,
        keyboard: document.getElementById("keyboard").value,
        guitar: document.getElementById("guitar").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        comments: document.getElementById("comments").value
    };
    try{
        if(editingId){
            await set(ref(db,"events/"+editingId), updated);
            showToast("Event aktualisiert!");
        } else {
            const newId = Date.now();
            await set(ref(db,"events/"+newId), updated);
            showToast("Event gespeichert!");
        }
        modal.style.display="none";
        loadEvents();
    }catch(e){ showToast("Fehler: "+e.message); }
});

/* EVENTS LADEN */
async function loadEvents(){
    const snapshot = await get(ref(db,"events"));
    const data = snapshot.exists()?snapshot.val():{};
    const tbody = document.getElementById("eventList");
    tbody.innerHTML="";
    for(let id in data){
        const e = data[id];
        const tr = document.createElement("tr");
        tr.innerHTML=`
            <td>${e.name}</td>
            <td>${e.leader}</td>
            <td>${e.type}</td>
            <td>${e.location}</td>
            <td>${e.date}</td>
            <td>${e.time}</td>
            <td>${e.mic}</td>
            <td>${e.vocals}</td>
            <td>${e.podium}</td>
            <td>${e.beamer}</td>
            <td>${e.keyboard}</td>
            <td>${e.guitar}</td>
            <td>${e.comments}</td>
            <td>
                <button class="action edit">Bearbeiten</button>
                <button class="action delete">Löschen</button>
                <button class="action details">Details</button>
            </td>
        `;
        tbody.appendChild(tr);

        tr.querySelector(".delete").addEventListener("click", async ()=>{
            if(confirm("Event wirklich löschen?")){
                await remove(ref(db,"events/"+id));
                showToast("Event gelöscht!");
                loadEvents();
            }
        });

        tr.querySelector(".edit").addEventListener("click", ()=>{
            editingId=id;
            document.getElementById("modalTitle").textContent="Event bearbeiten";
            document.getElementById("name").value=e.name;
            document.getElementById("leader").value=e.leader;
            document.getElementById("type").value=e.type;
            document.getElementById("location").value=e.location;
            document.getElementById("mic").value=e.mic;
            document.getElementById("vocals").value=e.vocals;
            document.getElementById("podium").value=e.podium;
            document.getElementById("beamer").value=e.beamer;
            document.getElementById("keyboard").value=e.keyboard;
            document.getElementById("guitar").value=e.guitar;
            document.getElementById("date").value=e.date;
            document.getElementById("time").value=e.time;
            document.getElementById("comments").value=e.comments;
            modal.style.display="flex";
        });

        tr.querySelector(".details").addEventListener("click", ()=>{
            let detailMsg = `Name: ${e.name}\nLeiter: ${e.leader}\nTyp: ${e.type}\nOrt: ${e.location}\nDatum: ${e.date}\nUhrzeit: ${e.time}\nMikrofone: ${e.mic}\nGesangs-Mics: ${e.vocals}\nRednerpult: ${e.podium}\nBeamer: ${e.beamer}\nKeyboards: ${e.keyboard}\nGitarren: ${e.guitar}\nKommentar: ${e.comments}`;
            alert(detailMsg);
        });
    }
}

loadEvents();
</script>
</body>
</html>
