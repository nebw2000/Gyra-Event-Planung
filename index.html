<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Event System</title>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #001a33, #004080);
            font-family: Arial;
            color: black;
        }

        .center {
            width: 90%;
            max-width: 500px;
            padding: 20px;
            margin: 60px auto;
            background: white;
            border-radius: 18px;
            border: 2px solid black;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: 2px solid black;
            border-radius: 8px;
            background: white;
            color: black;
        }

        button {
            padding: 12px 18px;
            background: #d9d9d9;
            color: black;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 12px;
        }

        .event-card {
            background: white;
            border: 2px solid black;
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
        }

        #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: black;
            border: 2px solid black;
            padding: 10px 16px;
            border-radius: 8px;
            display: none;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

<!-- TOAST -->
<div id="toast">Gespeichert</div>

<!-- LOGIN -->
<div id="loginBox" class="center">
    <h2>Login</h2>
    <input id="loginUser" placeholder="Benutzer">
    <input id="loginPass" type="password" placeholder="Passwort">
    <button onclick="login()">Einloggen</button>
</div>

<!-- ÜBERSICHT -->
<div id="mainBox" class="center hidden">
    <h2>Event Übersicht</h2>

    <button onclick="openAdd()">Event hinzufügen</button>

    <div id="eventList"></div>
</div>

<!-- EVENT HINZUFÜGEN -->
<div id="addBox" class="center hidden">
    <h2>Neues Event</h2>

    <input id="eventName" placeholder="Name">
    <input id="eventDate" type="date">
    <input id="eventLeader" placeholder="Leiter">
    
    <label>Rednerpult?</label>
    <select id="eventPult">
        <option>Ja</option>
        <option>Nein</option>
    </select>

    <textarea id="eventDescr" placeholder="Beschreibung"></textarea>

    <button onclick="saveEvent()">Speichern</button>
    <button onclick="backToMain()">Zurück</button>
</div>


<script type="module">

/* Firebase einbinden */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue } 
    from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCXX4CwnX_eRiKBURJeORfGoYI0k0hdHkA",
  authDomain: "event-plan-c4b36.firebaseapp.com",
  databaseURL: "https://event-plan-c4b36-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "event-plan-c4b36",
  storageBucket: "event-plan-c4b36.firebasestorage.app",
  messagingSenderId: "489710650124",
  appId: "1:489710650124:web:6a515ffd6ec3d9983aff29"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* LOGIN */
function login() {
    const u = loginUser.value;
    const p = loginPass.value;

    if ((u === "lehrerin" && p === "event") ||
        (u === "admin" && p === "2309") ||
        (u === "user" && p === "1234")) {

        loginBox.classList.add("hidden");
        mainBox.classList.remove("hidden");

    }
}

/* ZUM HINZUFÜGEN */
function openAdd() {
    mainBox.classList.add("hidden");
    addBox.classList.remove("hidden");
}

/* ZURÜCK */
function backToMain() {
    addBox.classList.add("hidden");
    mainBox.classList.remove("hidden");
}

/* SPEICHERN */
function saveEvent() {
    const name = eventName.value.trim();
    const date = eventDate.value;
    const leader = eventLeader.value.trim();
    const pult = eventPult.value;
    const descr = eventDescr.value.trim();

    if (!name || !date) return;

    const newRef = push(ref(db, "events"));
    set(newRef, {
        name,
        date,
        leader,
        pult,
        descr
    });

    showToast();
    backToMain();
}

/* TOAST */
function showToast() {
    const t = document.getElementById("toast");
    t.style.display = "block";
    setTimeout(() => t.style.display = "none", 3000);
}

/* LADEN */
function loadEvents() {
    const eventsRef = ref(db, "events");

    onValue(eventsRef, snap => {
        const list = document.getElementById("eventList");
        list.innerHTML = "";

        const data = snap.val();
        if (!data) return;

        const items = Object.entries(data)
            .sort((a, b) => new Date(a[1].date) - new Date(b[1].date));

        items.forEach(([id, ev]) => {
            const card = document.createElement("div");
            card.className = "event-card";

            card.innerHTML = `
                <b>${ev.name}</b><br>
                ${ev.date}<br>
                Leiter: ${ev.leader}<br>
                Rednerpult: ${ev.pult}<br><br>
                <button onclick="deleteEvent('${id}')">Löschen</button>
            `;

            list.appendChild(card);
        });
    });
}

window.deleteEvent = function(id) {
    set(ref(db, "events/" + id), null);
};

loadEvents();
</script>

</body>
</html>
