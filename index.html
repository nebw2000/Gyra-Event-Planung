<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event Verwaltung</title>

<style>
    body {
        margin: 0;
        background: #0077b6;
        font-family: Arial, sans-serif;
    }

    .view {
        display: none;
    }

    header {
        background: white;
        padding: 15px;
        border-bottom: 2px solid black;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    button {
        background: #d9d9d9;
        border: 1px solid black;
        color: black;
        padding: 10px 14px;
        border-radius: 6px;
        cursor: pointer;
    }

    button:hover {
        background: #c9c9c9;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        background: white;
        border: 1px solid black;
        border-radius: 4px;
        color: black;
        margin-bottom: 12px;
        box-sizing: border-box;
    }

    table {
        width: 100%;
        background: white;
        border-collapse: collapse;
    }

    th, td {
        border: 1px solid black;
        padding: 10px;
    }

    #toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 12px 18px;
        border: 1px solid black;
        border-radius: 6px;
        color: black;
        display: none;
    }

    /* Login */
    #loginBox {
        width: 320px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid black;
        margin: 80px auto;
    }

</style>
</head>

<body>

<div id="toast"></div>

<!-- LOGIN -->
<div id="loginView" class="view" style="display:block;">
    <div id="loginBox">
        <h3>Login</h3>
        <input id="loginUser" placeholder="Benutzer">
        <input id="loginPass" placeholder="Passwort" type="password">
        <button onclick="login()">Login</button>
    </div>
</div>

<!-- ÜBERSICHT -->
<div id="homeView" class="view">
    <header>
        <h2>Event Übersicht</h2>
        <div>
            <button onclick="switchView('createView')">Neues Event</button>
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <div style="padding:20px;">
        <table>
            <thead>
                <tr>
                    <th>Datum</th>
                    <th>Name</th>
                    <th>Leiter</th>
                    <th>Rednerpult</th>
                </tr>
            </thead>
            <tbody id="eventTable"></tbody>
        </table>
    </div>
</div>

<!-- EVENT ANLEGEN -->
<div id="createView" class="view">
    <header>
        <h2>Neues Event</h2>
        <button onclick="switchView('homeView')">Zurück</button>
    </header>

    <div style="padding:20px;">
        <input id="eventName" placeholder="Name">
        <input id="eventLeader" placeholder="Leiter">
        <input id="eventDate" type="date">

        <label>Rednerpult</label>
        <select id="eventPult">
            <option value="Ja">Ja</option>
            <option value="Nein">Nein</option>
        </select>

        <button onclick="saveEvent()">Speichern</button>
    </div>
</div>

<script type="module">
import { db, auth } from "./firebase-config.js";
import { 
    set, 
    ref, 
    push, 
    onValue 
} from "./firebase.js";

/* VIEWS */
function switchView(id) {
    document.querySelectorAll(".view").forEach(v => v.style.display = "none");
    document.getElementById(id).style.display = "block";
}

/* LOGIN */
function login() {
    const u = loginUser.value.trim();
    const p = loginPass.value.trim();

    if ((u === "lehrer" && p === "event") ||
        (u === "admin" && p === "2309") ||
        (u === "gast" && p === "1234")) {

        switchView("homeView");
        loadEvents();
        return;
    }

    showToast("Login falsch");
}

window.login = login;

/* LOGOUT */
function logout() {
    switchView("loginView");
}
window.logout = logout;

/* SAVE EVENT */
function saveEvent() {
    const name = eventName.value.trim();
    const leader = eventLeader.value.trim();
    const date = eventDate.value;
    const pult = eventPult.value;

    if (!name || !leader || !date) {
        showToast("Felder ausfüllen");
        return;
    }

    const path = ref(db, "events");
    const newRef = push(path);

    set(newRef, {
        name, leader, date, pult
    }).then(() => {
        showToast("Gespeichert");
        setTimeout(() => {
            switchView("homeView");
        }, 3000);
    });
}
window.saveEvent = saveEvent;

/* LOAD EVENTS */
function loadEvents() {
    const path = ref(db, "events");
    onValue(path, snap => {
        const table = document.getElementById("eventTable");
        table.innerHTML = "";

        const data = snap.val();
        if (!data) return;

        const arr = Object.values(data);
        arr.sort((a,b) => a.date.localeCompare(b.date));

        arr.forEach(e => {
            table.innerHTML += `
                <tr>
                    <td>${e.date}</td>
                    <td>${e.name}</td>
                    <td>${e.leader}</td>
                    <td>${e.pult}</td>
                </tr>
            `;
        });
    });
}

/* TOAST */
function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.style.display = "block";
    setTimeout(() => t.style.display = "none", 3000);
}

</script>

</body>
</html>
