<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Event-Kalender</title>
<style>
    body { font-family: Arial; margin:0; background:#f4f6f8; }
    header { background:#0f5f57; color:white; padding:15px 25px; display:flex; justify-content:space-between; align-items:center; }
    header button { background:#ffffff33; border:none; padding:8px 14px; color:white; border-radius:6px; cursor:pointer; }
    .container { max-width:900px; margin:auto; padding:20px; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; }
    .day { background:white; border-radius:6px; min-height:80px; padding:5px; position:relative; }
    .day span { font-weight:bold; position:absolute; top:5px; left:5px; }
    .event { background:#0f5f57; color:white; font-size:12px; padding:2px 4px; border-radius:4px; margin-top:18px; cursor:pointer; display:block; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    #monthYear { text-align:center; margin-bottom:15px; font-size:18px; }
    #toast { position:fixed; top:15px; left:50%; transform:translateX(-50%); background:#0f5f57; padding:10px 14px; color:white; border-radius:8px; display:none; }
    button.nav { background:#0f5f57; color:white; border:none; padding:6px 12px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>

<header>
    <h2>Event-Kalender</h2>
    <button onclick="window.location.href='index.html'">Zur Übersicht</button>
</header>

<div class="container">
    <div id="toast"></div>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <button class="nav" id="prevMonth">&lt; Vorheriger Monat</button>
        <div id="monthYear"></div>
        <button class="nav" id="nextMonth">Nächster Monat &gt;</button>
    </div>
    <div class="calendar" id="calendar"></div>
</div>

<script type="module">
import { db } from "./firebase-config.js";
import { ref, get } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";

const calendarEl = document.getElementById("calendar");
const monthYearEl = document.getElementById("monthYear");
let currentDate = new Date();
const toast = document.getElementById("toast");
function showToast(msg){ toast.textContent=msg; toast.style.display="block"; setTimeout(()=>{toast.style.display="none";},3000); }

async function loadEvents(){
    const snapshot = await get(ref(db,"events"));
    const data = snapshot.exists()?snapshot.val():{};
    const events = [];
    for(let id in data){
        const e = data[id];
        if(e.date) events.push({id, name:e.name, date:e.date});
    }
    return events;
}

async function drawCalendar(){
    calendarEl.innerHTML="";
    const month = currentDate.getMonth();
    const year = currentDate.getFullYear();
    monthYearEl.textContent = `${year}-${month+1}`;

    const firstDay = new Date(year, month, 1).getDay();
    const lastDate = new Date(year, month+1, 0).getDate();
    const events = await loadEvents();

    for(let i=0;i<firstDay;i++){ calendarEl.appendChild(document.createElement("div")); }

    for(let day=1;day<=lastDate;day++){
        const dayEl = document.createElement("div");
        dayEl.className="day";
        dayEl.innerHTML=`<span>${day}</span>`;
        const dayEvents = events.filter(ev=>{
            const d = new Date(ev.date);
            return d.getFullYear()===year && d.getMonth()===month && d.getDate()===day;
        });
        dayEvents.forEach(ev=>{
            const evEl = document.createElement("span");
            evEl.className="event";
            evEl.textContent = ev.name;
            evEl.onclick = ()=>{ window.location.href=`edit.html?id=${ev.id}`; };
            dayEl.appendChild(evEl);
        });
        calendarEl.appendChild(dayEl);
    }
}

document.getElementById("prevMonth").addEventListener("click", ()=>{ currentDate.setMonth(currentDate.getMonth()-1); drawCalendar(); });
document.getElementById("nextMonth").addEventListener("click", ()=>{ currentDate.setMonth(currentDate.getMonth()+1); drawCalendar(); });

drawCalendar();
</script>
</body>
</html>
